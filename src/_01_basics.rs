// ============================================================================
// 01. ê¸°ë³¸ ë¬¸ë²• - ë³€ìˆ˜, íƒ€ì…, í•¨ìˆ˜
// ============================================================================
// C++20ê³¼ì˜ í•µì‹¬ ì°¨ì´ì :
// 1. ë³€ìˆ˜ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë¶ˆë³€(immutable) - C++ì˜ constê°€ ê¸°ë³¸ê°’
// 2. íƒ€ì… ì¶”ë¡ ì´ ë” ê°•ë ¥í•¨ - autoë³´ë‹¤ ë” ë§ì€ ìƒí™©ì—ì„œ ë™ì‘
// 3. ì„¸ë¯¸ì½œë¡  ì—†ëŠ” ë§ˆì§€ë§‰ í‘œí˜„ì‹ì´ ë°˜í™˜ê°’ - return í‚¤ì›Œë“œ ìƒëµ ê°€ëŠ¥
// 4. ëª¨ë“  ê²ƒì´ í‘œí˜„ì‹(expression) - if, match ë“±ë„ ê°’ì„ ë°˜í™˜
// ============================================================================

pub fn run() {
    println!("\n=== 01. ê¸°ë³¸ ë¬¸ë²• ===\n");

    variables();
    types();
    functions_demo();
    control_flow();
    expressions();
}

// ----------------------------------------------------------------------------
// ë³€ìˆ˜ ì„ ì–¸
// ----------------------------------------------------------------------------
fn variables() {
    println!("--- ë³€ìˆ˜ ì„ ì–¸ ---");

    // C++: int x = 5;           // ê¸°ë³¸ì ìœ¼ë¡œ ê°€ë³€
    // C++: const int x = 5;     // ë¶ˆë³€ìœ¼ë¡œ ë§Œë“¤ë ¤ë©´ const í•„ìš”

    // Rust: ê¸°ë³¸ì ìœ¼ë¡œ ë¶ˆë³€
    let x = 5;
    // x = 6;  // ì»´íŒŒì¼ ì—ëŸ¬! cannot assign twice to immutable variable

    // Rust: ê°€ë³€ìœ¼ë¡œ ë§Œë“¤ë ¤ë©´ mut í‚¤ì›Œë“œ í•„ìš”
    let mut y = 5;
    println!("y ë³€ê²½ ì „: {}", y);
    y = 6;  // OK
    println!("y ë³€ê²½ í›„: {}", y);

    // ì„€ë„ì‰(Shadowing) - C++ì—ëŠ” ì—†ëŠ” ê°œë…
    // ê°™ì€ ì´ë¦„ìœ¼ë¡œ ìƒˆ ë³€ìˆ˜ë¥¼ ì„ ì–¸í•˜ë©´ ì´ì „ ë³€ìˆ˜ë¥¼ ê°€ë¦¼
    let x = x + 1;  // ìƒˆë¡œìš´ xê°€ ì´ì „ xë¥¼ ê°€ë¦¼
    let x = x * 2;  // ë˜ ë‹¤ì‹œ ê°€ë¦¼
    println!("ì„€ë„ì‰ëœ x: {}", x);  // 12

    // ì„€ë„ì‰ìœ¼ë¡œ íƒ€ì…ë„ ë³€ê²½ ê°€ëŠ¥
    let spaces = "   ";        // &str íƒ€ì…
    let spaces = spaces.len(); // usize íƒ€ì…ìœ¼ë¡œ ë³€ê²½
    println!("ê³µë°± ê°œìˆ˜: {}", spaces);

    // C++ì—ì„œëŠ” ì´ë ‡ê²Œ í•´ì•¼ í•¨:
    // std::string spaces_str = "   ";
    // size_t spaces = spaces_str.length();  // ë‹¤ë¥¸ ì´ë¦„ í•„ìš”
}

// ----------------------------------------------------------------------------
// ê¸°ë³¸ íƒ€ì…
// ----------------------------------------------------------------------------
fn types() {
    println!("\n--- ê¸°ë³¸ íƒ€ì… ---");

    // ì •ìˆ˜ íƒ€ì… - C++ë³´ë‹¤ ëª…í™•í•œ í¬ê¸° ì§€ì •
    // C++: int, long, long long ë“±ì€ í”Œë«í¼ë§ˆë‹¤ í¬ê¸°ê°€ ë‹¤ë¦„
    // Rust: í¬ê¸°ê°€ ì´ë¦„ì— ëª…ì‹œë¨
    let _i8_val: i8 = -128;                    // C++: int8_t
    let _i16_val: i16 = -32768;                // C++: int16_t
    let _i32_val: i32 = -2147483648;           // C++: int32_t
    let _i64_val: i64 = -9223372036854775808;  // C++: int64_t
    let _i128_val: i128 = -1;                  // C++ì—ëŠ” ì—†ìŒ!

    let _u8_val: u8 = 255;                     // C++: uint8_t
    let _u16_val: u16 = 65535;                 // C++: uint16_t
    let _u32_val: u32 = 4294967295;            // C++: uint32_t
    let _u64_val: u64 = 18446744073709551615;  // C++: uint64_t
    let _u128_val: u128 = 1;                   // C++ì—ëŠ” ì—†ìŒ!

    // isize, usize - í¬ì¸í„° í¬ê¸°ì™€ ë™ì¼ (32ë¹„íŠ¸ì—ì„œ 32ë¹„íŠ¸, 64ë¹„íŠ¸ì—ì„œ 64ë¹„íŠ¸)
    // C++: size_t, ptrdiff_tì™€ ìœ ì‚¬
    let _size: usize = 100;
    let _ptr_diff: isize = -50;

    // ë¶€ë™ì†Œìˆ˜ì 
    let _f32_val: f32 = 3.14;   // C++: float
    let _f64_val: f64 = 3.14;   // C++: double (ê¸°ë³¸ê°’)
    let _default_float = 3.14; // f64ê°€ ê¸°ë³¸ (C++ê³¼ ë™ì¼í•˜ê²Œ double)

    // ë¶ˆë¦¬ì–¸
    let _bool_val: bool = true;  // C++: bool

    // ë¬¸ì - C++ê³¼ ë‹¤ë¥´ê²Œ 4ë°”ì´íŠ¸ (ìœ ë‹ˆì½”ë“œ ìŠ¤ì¹¼ë¼ ê°’)
    // C++: charëŠ” 1ë°”ì´íŠ¸, wchar_tëŠ” í”Œë«í¼ ì˜ì¡´ì 
    let _char_val: char = 'ê°€';  // í•œê¸€ë„ í•˜ë‚˜ì˜ charì— ì €ì¥ ê°€ëŠ¥
    let _emoji: char = 'ğŸ¦€';     // ì´ëª¨ì§€ë„ ê°€ëŠ¥!
    println!("Rust char í¬ê¸°: {} ë°”ì´íŠ¸", std::mem::size_of::<char>());

    // íŠœí”Œ - C++: std::tuple
    // C++: auto tuple = std::make_tuple(500, 6.4, true);
    let tuple: (i32, f64, bool) = (500, 6.4, true);

    // êµ¬ì¡° ë¶„í•´ (C++17 structured bindingê³¼ ìœ ì‚¬)
    // C++: auto [x, y, z] = tuple;
    let (a, b, c) = tuple;
    println!("íŠœí”Œ ë¶„í•´: {}, {}, {}", a, b, c);

    // ì¸ë±ìŠ¤ ì ‘ê·¼
    // C++: std::get<0>(tuple)
    println!("íŠœí”Œ ì²« ë²ˆì§¸ ìš”ì†Œ: {}", tuple.0);

    // ë°°ì—´ - ê³ ì • í¬ê¸°, ìŠ¤íƒì— í• ë‹¹
    // C++: std::array<i32, 5> arr = {1, 2, 3, 4, 5};
    let arr: [i32; 5] = [1, 2, 3, 4, 5];
    println!("ë°°ì—´ ì²« ë²ˆì§¸: {}", arr[0]);

    // ê°™ì€ ê°’ìœ¼ë¡œ ì´ˆê¸°í™”
    // C++ì—ëŠ” ì§ì ‘ì ì¸ ëŒ€ì‘ì´ ì—†ìŒ (fill ì‚¬ìš©í•´ì•¼ í•¨)
    let zeros = [0; 10];  // [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    println!("0ìœ¼ë¡œ ì±„ìš´ ë°°ì—´ ê¸¸ì´: {}", zeros.len());

    // ìŠ¬ë¼ì´ìŠ¤ - ë°°ì—´ì˜ ì¼ë¶€ë¥¼ ì°¸ì¡°
    // C++20: std::spanê³¼ ìœ ì‚¬
    let slice: &[i32] = &arr[1..4];  // [2, 3, 4]
    println!("ìŠ¬ë¼ì´ìŠ¤: {:?}", slice);
}

// ----------------------------------------------------------------------------
// í•¨ìˆ˜
// ----------------------------------------------------------------------------
fn functions_demo() {
    println!("\n--- í•¨ìˆ˜ ---");

    // ê¸°ë³¸ í•¨ìˆ˜ í˜¸ì¶œ
    let sum = add(5, 3);
    println!("5 + 3 = {}", sum);

    // í‘œí˜„ì‹ ë°˜í™˜
    let doubled = double(21);
    println!("21 * 2 = {}", doubled);

    // ì—¬ëŸ¬ ê°’ ë°˜í™˜ (íŠœí”Œ ì‚¬ìš©)
    // C++: std::tuple<int, int> ë˜ëŠ” êµ¬ì¡°ì²´ ë°˜í™˜
    let (quot, rem) = divide(17, 5);
    println!("17 / 5 = {} ë‚˜ë¨¸ì§€ {}", quot, rem);
}

// C++: int add(int a, int b) { return a + b; }
fn add(a: i32, b: i32) -> i32 {
    return a + b;  // return ì‚¬ìš© ê°€ëŠ¥
}

// ë§ˆì§€ë§‰ í‘œí˜„ì‹ì´ ë°˜í™˜ê°’ (ì„¸ë¯¸ì½œë¡  ì—†ìŒ!)
fn double(x: i32) -> i32 {
    x * 2  // return ì—†ì´, ì„¸ë¯¸ì½œë¡ ë„ ì—†ìŒ
    // x * 2; ë¼ê³  ì“°ë©´ ()ë¥¼ ë°˜í™˜í•˜ê²Œ ë˜ì–´ ì»´íŒŒì¼ ì—ëŸ¬!
}

fn divide(dividend: i32, divisor: i32) -> (i32, i32) {
    (dividend / divisor, dividend % divisor)
}

// ë°˜í™˜ê°’ì´ ì—†ëŠ” í•¨ìˆ˜ - C++ì˜ void
// ì‹¤ì œë¡œëŠ” ìœ ë‹› íƒ€ì… ()ë¥¼ ë°˜í™˜
fn _no_return() {
    println!("ë°˜í™˜ê°’ ì—†ìŒ");
    // -> () ê°€ ìƒëµëœ ê²ƒ
}

// ----------------------------------------------------------------------------
// ì œì–´ íë¦„
// ----------------------------------------------------------------------------
fn control_flow() {
    println!("\n--- ì œì–´ íë¦„ ---");

    let number = 6;

    // if ë¬¸ - ì¡°ê±´ì— ê´„í˜¸ ë¶ˆí•„ìš” (C++ê³¼ ë‹¤ë¦„)
    // C++: if (number < 5) { ... }
    if number < 5 {
        println!("5ë³´ë‹¤ ì‘ìŒ");
    } else if number > 5 {
        println!("5ë³´ë‹¤ í¼");
    } else {
        println!("5ì™€ ê°™ìŒ");
    }

    // ifëŠ” í‘œí˜„ì‹! (C++ì˜ ì‚¼í•­ ì—°ì‚°ìì™€ ìœ ì‚¬í•˜ì§€ë§Œ ë” ê°•ë ¥)
    // C++: int result = (number > 5) ? 1 : 0;
    let result = if number > 5 { "í¬ë‹¤" } else { "ì‘ê±°ë‚˜ ê°™ë‹¤" };
    println!("ê²°ê³¼: {}", result);

    // loop - ë¬´í•œ ë£¨í”„ (C++: while(true))
    let mut counter = 0;
    let result = loop {
        counter += 1;
        if counter == 10 {
            break counter * 2;  // ê°’ì„ ë°˜í™˜í•˜ë©° íƒˆì¶œ!
        }
    };
    println!("loop ê²°ê³¼: {}", result);  // 20

    // while
    let mut n = 3;
    while n != 0 {
        println!("{}!", n);
        n -= 1;  // n-- ëŠ” Rustì— ì—†ìŒ!
    }

    // for - C++11 range-based forì™€ ìœ ì‚¬
    // C++: for (const auto& elem : arr) { ... }
    let arr = [10, 20, 30, 40, 50];
    for element in arr {
        println!("ê°’: {}", element);
    }

    // ë²”ìœ„ ë°˜ë³µ
    // C++: for (int i = 0; i < 5; i++) { ... }
    for i in 0..5 {  // 0, 1, 2, 3, 4 (5 ë¯¸í¬í•¨)
        print!("{} ", i);
    }
    println!();

    // í¬í•¨ ë²”ìœ„
    for i in 0..=5 {  // 0, 1, 2, 3, 4, 5 (5 í¬í•¨)
        print!("{} ", i);
    }
    println!();

    // ì—­ìˆœ ë°˜ë³µ
    for i in (1..4).rev() {
        println!("ì¹´ìš´íŠ¸ë‹¤ìš´: {}!", i);
    }
}

// ----------------------------------------------------------------------------
// í‘œí˜„ì‹ vs ë¬¸ì¥
// ----------------------------------------------------------------------------
fn expressions() {
    println!("\n--- í‘œí˜„ì‹ ---");

    // Rustì—ì„œ ê±°ì˜ ëª¨ë“  ê²ƒì€ í‘œí˜„ì‹
    // ë¸”ë¡ {}ë„ í‘œí˜„ì‹ì´ê³ , ë§ˆì§€ë§‰ í‘œí˜„ì‹ì˜ ê°’ì„ ë°˜í™˜

    let y = {
        let x = 3;
        x + 1  // ì„¸ë¯¸ì½œë¡  ì—†ìŒ = ì´ ë¸”ë¡ì˜ ë°˜í™˜ê°’
    };
    println!("ë¸”ë¡ í‘œí˜„ì‹ ê²°ê³¼: {}", y);  // 4

    // matchë„ í‘œí˜„ì‹ (C++ì˜ switchë³´ë‹¤ ê°•ë ¥)
    let number = 13;
    let description = match number {
        1 => "í•˜ë‚˜",
        2 | 3 | 5 | 7 | 11 | 13 => "ì†Œìˆ˜",  // ì—¬ëŸ¬ íŒ¨í„´
        13..=19 => "ì‹­ëŒ€",                   // ë²”ìœ„ íŒ¨í„´
        _ => "ê¸°íƒ€",                         // default
    };
    println!("{} ëŠ” {}", number, description);
}
